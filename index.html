<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Console | Huahin Properties</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f8fafc; padding-bottom: 50px; }
        label { display: block; font-size: 13px; color: #64748b; font-weight: 700; margin-top: 15px; margin-bottom: 5px; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 15px; outline: none; }
        .btn-group { margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 14px; border-radius: 12px; font-weight: 800; text-align: center; cursor: pointer; text-transform: uppercase; }
        .btn-save { background: #2563eb; color: white; }
    </style>
</head>
<body class="px-6">
    <h1 class="text-2xl font-black text-blue-900 text-center py-8">ADMIN CONSOLE</h1>
    
    <form id="propertyForm" class="max-w-xl mx-auto bg-white p-6 rounded-3xl shadow-sm border">
        <label>SELECT ENTRY</label>
        <select id="editSelector" onchange="loadData()" class="bg-blue-50 border-blue-200"><option value="">-- NEW ENTRY --</option></select>

        <div class="grid grid-cols-2 gap-4">
            <div><label>ID (Code)</label><input type="text" id="ID" required></div>
            <div><label>Plot Number</label><input type="text" id="Plot"></div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div><label>Bedrooms</label><input type="text" id="Bedrooms"></div>
            <div><label>Bathrooms</label><input type="text" id="Bathrooms"></div>
        </div>

        <label>District (อำเภอ)</label>
        <select id="District" onchange="updateSubDistricts()">
            <option value="">-- Select District --</option>
            <option value="หัวหิน">หัวหิน (Hua Hin)</option>
            <option value="ชะอำ">ชะอำ (Cha-am)</option>
            <option value="ปราณบุรี">ปราณบุรี (Pran Buri)</option>
        </select>

        <label>Sub-District (ตำบล)</label>
        <select id="SubDistrict">
            <option value="">-- Select District First --</option>
        </select>

        <label>Price (THB)</label><input type="number" id="Price">
        <label>Status</label>
        <select id="Status">
            <option value="Ready to move in">Ready to move in</option>
            <option value="Under Construction">Under Construction</option>
            <option value="Sold Out">Sold Out</option>
        </select>

        <label>Description</label><textarea id="Description" rows="3"></textarea>
        <label>Thumbnail Link</label><input type="text" id="Thumbnail">
        <label>FB Link</label><input type="text" id="FBLink">

        <div class="hidden">
            <input type="text" id="Pavilion" value="No">
            <input type="text" id="LandAreaSqM"><input type="text" id="LandAreaSqW">
            <input type="text" id="LivingArea"><input type="text" id="PoolSize">
            <input type="text" id="PoolDepth"><input type="text" id="Furnishing">
            <input type="text" id="Badge"><input type="text" id="Type">
            <input type="text" id="Parking"><input type="text" id="Electricity">
        </div>

        <div class="btn-group">
            <div class="btn border-2" onclick="location.reload()">Cancel</div>
            <div class="btn btn-save" onclick="saveData()" id="saveBtn">Save Data</div>
        </div>
    </form>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbySAdfx_Exm6QHYJRcgSAYBWqWFk3l4ldj4pI6Uc2eAkhkpD_SvE0UDwBSfOPWgAxY1/exec";
        const subDistMap = {
            "หัวหิน": ["หัวหิน", "หนองแก", "หินเหล็กไฟ", "หนองพลับ", "ทับใต้", "ห้วยสัตว์ใหญ่", "บึงนคร"],
            "ชะอำ": ["ชะอำ", "บางเก่า", "นายาง", "เขาใหญ่", "หนองศาลา", "ห้วยทรายเหนือ", "ไร่ใหม่พัฒนา", "สามพระยา", "ดอนขุนห้วย"],
            "ปราณบุรี": ["ปราณบุรี", "เขาน้อย", "ปากน้ำปราณ", "หนองตาแต้ม", "วังก์พง", "เขาจ้าว"]
        };

        function updateSubDistricts() {
            const dist = document.getElementById('District').value;
            const subDistSelect = document.getElementById('SubDistrict');
            subDistSelect.innerHTML = '<option value="">-- Select Sub-District --</option>';
            if(subDistMap[dist]) {
                subDistMap[dist].forEach(s => {
                    const o = document.createElement('option'); o.value = s; o.text = s; subDistSelect.add(o);
                });
            }
        }

        async function saveData() {
            const btn = document.getElementById('saveBtn'); btn.innerText = "SAVING...";
            const fields = ["ID","Plot","Bedrooms","Bathrooms","Pavilion","LandAreaSqM","LandAreaSqW","LivingArea","PoolSize","PoolDepth","Furnishing","Price","Status","Badge","Type","Description","Parking","Electricity","District","SubDistrict","Thumbnail","FBLink"];
            const data = {};
            fields.forEach(f => {
                const el = document.getElementById(f.replace(/\s/g,''));
                if(el) data[f === "LandAreaSqM" ? "Land Area (sq.m)" : f === "LandAreaSqW" ? "Land Area (sq.w)" : f] = el.value;
            });
            await fetch(GAS_URL, {method:'POST', body:JSON.stringify({action:"save", data: data})});
            alert("Success!"); location.reload();
        }
    </script>
</body>
</html>
